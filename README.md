# Sales Analyzer
Программа для анализа данных о продажах из JSON файлов

Проект компилируется путём сборки файлов Sales__2_.cpp и generate_data_mf.cpp в исполняемый файл. После компиляции программа работает самостоятельно, ничего кроме компиляции делать не нужно.

## Компиляция

```bash
g++ -std=c++11 -O2 Sales.cpp generate_data_mf.cpp -o sales
```

## Инструкция по работе

### Режимы запуска

После компиляции программа запускается с различными командами:

**1. Режим анализа одного файла:**
```bash
./sales --input data/sales_100.json
```
Программа читает один JSON файл с массивом заказов и выводит полную статистику.

**2. Режим анализа директории:**
```bash
./sales --input data/separate_100
```
Программа сканирует указанную директорию, находит все JSON файлы, читает их по очереди и выводит общую статистику по всем заказам.

**3. Режим генерации тестовых данных:**
```bash
./sales --generate --preset small      # 100 файлов
./sales --generate --preset medium     # 1,000 файлов
./sales --generate --preset large      # 10,000 файлов
```

Или с указанием параметров вручную:
```bash
./sales --generate --output data/test --count 500
```

**4. Режим автоматического тестирования (СТАРТ-ТЕСТ):**
```bash
./sales --starttest
```
Запускает автоматический бенчмарк производительности с созданием отчёта.

---

### Генератор тестовых данных

При использовании команды `--generate` программа создаёт JSON файлы с тестовыми данными о заказах.

**Структура генерируемых данных:**

Каждый JSON файл содержит массив заказов следующего формата:
```json
[
  {
    "id": "ORD000001",
    "ts": "2025-12-22T14:30:45Z",
    "items": [
      {"sku": "PROD-123A", "qty": 5, "price": 1234.56}
    ]
  }
]
```

**Параметры генерации:**

- **ID заказа:** Уникальный идентификатор в формате ORD000001, ORD000002 и т.д.
- **Временная метка (ts):** Случайная дата в диапазоне последних 30 дней в формате ISO 8601
- **Товары (items):** Массив товаров в заказе (от 1 до 10 позиций)
  - **Артикул (sku):** Случайный артикул в формате PROD-XXXX (4 случайных символа)
  - **Количество (qty):** Случайное число от 1 до 20
  - **Цена (price):** Случайная цена от 100.00 до 10000.00 руб.

**Пресеты генерации:**

- `--preset small` - Создаёт 100 отдельных JSON файлов (по 1 заказу в каждом)
- `--preset medium` - Создаёт 1,000 отдельных JSON файлов
- `--preset large` - Создаёт 10,000 отдельных JSON файлов
- `--preset errors` - Создаёт 1,000 отдельных JSON файлов с ошибками

После генерации файлы сохраняются в указанную директорию (по умолчанию `data/`), и программа выводит сообщение об успешном завершении.

---

### Список доступных команд

После запуска программы доступны следующие команды:

• **Справка по использованию** - `--help` или `-h`  
• **Анализ файла или директории** - `--input <путь>` или `-i <путь>`  
• **Указать количество топ-товаров** - `--top <число>` или `-t <число>` (по умолчанию 5)  
• **Генерация тестовых данных** - `--generate`  
• **Автоматический бенчмарк** - `--starttest` или `-st` генерирует .md отчет в папку `tests/`

**Примеры использования:**

```bash
# Справка
./sales --help

# Анализ одного файла с топ-10 товаров
./sales --input data/sales_100.json --top 10

# Анализ директории
./sales --input data/separate_1k

# Генерация 500 файлов
./sales --generate --count 500 --output data/test

# Запуск бенчмарка
./sales --starttest
```

---

### Режим анализа файла

При использовании команды `--input` с путём к JSON файлу программа выполняет следующие действия:

1. **Открывает и читает JSON файл**
2. **Парсит массив заказов**
3. **Проверяет валидность данных** (корректность ID, временных меток, наличие товаров)
4. **Рассчитывает статистику:**
   - Общее количество заказов
   - Общая выручка
   - Средний чек
   - Выручка по дням
   - Топ-N товаров по выручке

Программа выводит результаты в следующем формате:

```
======================================================================
  ОБЩАЯ СТАТИСТИКА
======================================================================

Всего заказов: 100
Общая выручка: 123,456.78 руб.
Средний чек: 1,234.57 руб.

======================================================================
  ВЫРУЧКА ПО ДНЯМ
======================================================================

2025-12-20    12,345.67 руб.
2025-12-21    15,432.10 руб.
2025-12-22    18,654.32 руб.
...

======================================================================
  ТОП-5 ТОВАРОВ ПО ВЫРУЧКЕ
======================================================================

1. PROD-7A2F    23,456.78 руб.    (19.0%)
2. PROD-3K9B    18,432.56 руб.    (14.9%)
3. PROD-5M1C    15,654.32 руб.    (12.7%)
...
```

**Обработка ошибок:**

- Если файл не найден, программа выводит сообщение: "Ошибка: файл <имя> не найден"
- Если JSON невалидный, программа пропускает битые записи и выводит предупреждение
- Если в файле нет заказов, выводится сообщение: "Файл не содержит заказов"

---

### Режим анализа директории

При использовании команды `--input` с путём к директории программа:

1. **Сканирует директорию** и находит все файлы с расширением `.json`
2. **Сортирует файлы** по имени для последовательной обработки
3. **Читает каждый файл** по очереди
4. **Показывает прогресс** для больших директорий (более 100 файлов):
   ```
   Найдено JSON файлов: 1000
     Прочитано файлов: 100/1000 (10%)
     Прочитано файлов: 200/1000 (20%)
     ...
   ```
5. **Объединяет все заказы** из всех файлов
6. **Выводит общую статистику** (аналогично режиму одного файла)

**Особенности:**

- Если в директории нет JSON файлов, программа выводит список доступных поддиректорий:
  ```
  В директории data нет JSON файлов.

  Найдены следующие директории в data:
  ----------------------------------------------------------------------
    1. separate_100 (100 JSON файлов)
    2. separate_1k (1000 JSON файлов)
    3. bench_10k (10000 JSON файлов)
  ----------------------------------------------------------------------

  Используйте:
    ./sales --input data/<имя_директории>
  ```

- Программа автоматически определяет, является ли путь файлом или директорией
- Битые или невалидные файлы пропускаются с выводом предупреждения

---

### Режим автоматического тестирования (--starttest)

При запуске команды `./sales --starttest` программа выполняет автоматический бенчмарк:

**Процесс тестирования:**

1. **Создаёт директорию** `tests/t1` (или t2, t3 для последующих запусков)
2. **Генерирует тестовые наборы** с различным количеством файлов:
   - 10 файлов
   - 100 файлов
   - 1,000 файлов
   - 10,000 файлов
   - 100,000 файлов
   - 250,000 файлов
3. **Измеряет время генерации** каждого набора
4. **Измеряет время обработки** каждого набора:
   - Чтение файлов
   - Валидация данных
   - Расчёт статистики
   - Поиск топ-товаров
5. **Создаёт детальный отчёт** в формате Markdown: `tests/t1.md`

**Пример отчёта:**

```markdown
# Benchmark Report

Тест: генерация n-го кол-ва JSON-файлов.

| Кол-во файлов | Время (ms) |
|--------------|-------------|
| 10 | 15 |
| 100 | 45 |
| 1000 | 255 |
| 10000 | 2500 |
| 100000 | 25000 |
| 250000 | 100000 |

Тест: обработка n-го кол-ва JSON-файлов.

| Кол-во файлов | Время (ms) |
|--------------|-------------|
| 10 | 2 |
| 100 | 21 |
| 1000 | 255 |
| 10000 | 2700 |
| 100000 | 28000 |
| 250000 | 100800 |
```

После завершения программа выводит:
```
Benchmark завершён: tests/t1
```

Отчёт можно открыть в любом редакторе, поддерживающем Markdown.

---

### Отчёт о сессии

После завершения работы программы автоматически создаётся файл `docs/report.txt` с детальным отчётом о сессии.

**Пример отчёта:**

```
=== ОТЧЁТ ПО СЕССИИ ===
Дата и время отчёта: Fri Dec 27 15:30:45 2025
Продолжительность сессии: 0ч 5м 18с
Общее количество введённых команд: 8
Общее количество обработанных файлов: 11134
Общее количество проанализированных заказов: 11134
Общая выручка: 14,287,563.42 руб.
Средний чек: 1,283.56 руб.

Обработано файлов по операциям:
  data/sales_100.json: 100 заказов
  data/separate_1k/: 1000 заказов
  data/bench_10k/: 10000 заказов
  tests/t1/gen_10: 10 заказов
  tests/t1/gen_100: 100 заказов
  tests/t1/gen_1000: 1000 заказов

Топ-5 товаров по выручке:
  PROD-7A2F: 234,567.89 руб.
  PROD-3K9B: 198,432.56 руб.
  PROD-5M1C: 187,654.32 руб.
========================
```

**Что отслеживает отчёт:**

• Дата и время завершения работы  
• Продолжительность сессии  
• Количество введённых команд  
• Количество обработанных файлов  
• Количество проанализированных заказов  
• Общая выручка по всем операциям  
• Средний чек  
• Детализация по каждой операции  
• Топ-5 товаров по выручке за сессию

Отчёт сохраняется в директорию `docs/` и может быть использован для анализа производительности и результатов работы программы.

---

### Обработка ошибок

Программа корректно обрабатывает следующие ситуации:

**1. Файл или директория не найдены:**
```
Ошибка: не могу открыть файл data/nonexistent.json
```

**2. Невалидный JSON:**
```
Предупреждение: пропущено 3 невалидных заказа в файле data/broken.json
```

**3. Пустой файл или директория:**
```
Файл data/empty.json не содержит заказов
```

**4. Нет прав доступа:**
```
Ошибка: не могу открыть директорию /root/data: Permission denied
```

**5. Неверные параметры командной строки:**
```
Ошибка: неизвестная команда --unknown
Используйте --help для справки
```

Программа устойчива к ошибкам и продолжает работу даже при наличии битых данных, пропуская невалидные записи.

---

## Структура проекта

```
sales-analyzer/
├── Sales__2_.cpp              # Основная программа
├── generate_data_mf.h         # Заголовочный файл генератора
├── generate_data_mf.cpp       # Реализация генератора
├── data/                      # Директория с данными
│   ├── sales_100.json
│   ├── sales_1k.json
│   ├── separate_100/
│   ├── separate_1k/
│   └── bench_10k/
├── tests/                     # Результаты бенчмарков
│   ├── t1/
│   ├── t1.md
│   └── t2.md
├── docs/                      # Документация и отчёты
│   └── report.txt
├── .gitignore
└── README.md
```

---

## Примеры использования

### Быстрый старт

```bash
# 1. Компиляция
g++ -std=c++11 -O2 Sales.cpp generate_data_mf.cpp -o sales

# 2. Генерация тестовых данных
./sales --generate --preset small

# 3. Анализ сгенерированных данных
./sales --input data/separate_100

# 4. Запуск бенчмарка
./sales --starttest
```

### Работа с реальными данными

```bash
# Анализ файла с вашими данными
./sales --input my_sales_data.json --top 20

# Анализ директории с множеством файлов
./sales --input /sales/data
```

### Тестирование производительности

```bash
# Создать большой набор данных
./sales --generate --count 50000 --output data/stress_test

# Проанализировать производительность
time ./sales --input data/stress_test
```

---

## Требования

- Компилятор: GCC 4.8+ или Clang 3.3+ или MSVC 2015+
- Стандарт: C++11 или выше
- ОС: Windows, Linux, macOS

---

## Производительность

Программа оптимизирована для работы с большими объёмами данных:

- **10 файлов:** ~2 мс
- **100 файлов:** ~20 мс
- **1,000 файлов:** ~250 мс
- **10,000 файлов:** ~5 сек
- **100,000 файлов:** ~55 сек
- **250,000 файлов:** ~145 сек


*Время указано для обработки (чтение + валидация + расчёты) на современном процессоре*

---

## Лицензия

Этот проект создан в учебных целях.

---

## Автор

Левин Серафим, группа МОАИС-О-25/1  
Ульяновск, 2025г.
# Final-Laboratory-Work
